#!/usr/bin/env sh

msg_file="$1"
first_line=$(sed -n '1p' "$msg_file")

# Allow merge commits generated by Git
case "$first_line" in
  "Merge "*|"Revert "*)
    exit 0
    ;;
esac

pattern='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-z0-9._/-]+\))?!?: .+$'

printf '%s' "$first_line" | grep -Eq "$pattern"
if [ $? -ne 0 ]; then
  echo ""
  echo "ERROR: Commit message must follow Conventional Commits."
  echo "Example: feat(auth): add token revoke confirmation modal"
  echo ""
  echo "Allowed types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
  exit 1
fi
